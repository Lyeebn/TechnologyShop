<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="./ico/Raphael.ico" />
    <title>ğŸ” grep ç­›é€‰é¡¹</title>
    <style>
	body {background-color:#A4C0A7; overflow-x:hidden} #xxr{padding-top:5em}
	span {white-space:nowrap} textarea:hover{height:52vh!important}
 	input.flt {min-width:25em}
	input:focus {background:pink} XXinput:focus {zoom:1.1;width:20em}
	#xxopp{background:#9B9;xxposition:fixed;width:98vw;opacity:.8}#opp:hover{ opacity:1; background:pink}
	#opp:hover::after{content:"æ–‡ä»¶æ‹–è¿‡æ¥é‡Šæ”¾æ‰“å¼€"; color:red; position:fixed;right:9px}
	pre {word-wrap:break-word; white-space:pre-wrap;}
	</style>
</head>
<body>
<iframe title="åˆ©ç”¨è¿™ä¸ªæ¥æ‰¿æ¥é¢å¤–çš„è·³è½¬å‰¯ä½œç”¨ï¼Œåªä¿ç•™ Submit çš„è®°å¿†" style="display:none" name="mdzz"></iframe>
<form target="mdzz" action="ä¼šè·³è½¬ä¸å¤ªå¥½åŠï¼Œå¯ä»¥ç”¨onsubmit return falseï¼Œä½†æœ‰ä¸ªé«˜æ˜çš„éªšæ“ä½œï¼Œæä¸ª iframeä¸“é—¨åƒè¿™å‰¯ä½œç”¨çš„ï¼Œç”¨targetæŒ‡å®šå®ƒæ¥ï¼Œgrep.html" method="put" id="opp"
	ondrop="æ‹–æ”¾å¤„ç†(event)" ondragleave="å›false(event)" ondragend="å›false(event)" ondragover="å›false(event)" autocomplete>
<span>
<textarea id="showSource" style="display:none"></textarea>
<input type="file" id="fileInput" multiple Xaccept="text/html,.txt,.tex" onchange="è¯»æ–‡ä»¶(this)" accesskey="1"/>
<input id="ps" value="" placeholder="ç®€å•æ‹†é¡¹ \book{ ã€ documentclass" onblur="æš´è®°(this);åˆ†æ‹†(txt,this.value)" />
<input id="res" value="begin.+?end" placeholder="æ­£åˆ™æ‹†é¡¹topic"  onblur="æš´è®°(this);reæ‹†(txt,this.value)" />
<a id="emcount">é¡¹æ•°</a>
<button onclick="reæ‹†(txt,'\\\\begin{InOnePage}.+?\\\\end{InOnePage}[\\n\\r]')" accesskey="t" id="ct">æ‹†é¢˜</button>
<button onclick="reæ‹†(txt,'\\\\begin{zhishiqingdan}.+?\\\\end{zhishiqingdan}')" accesskey="z">æ‹†çŸ¥</button>
<button onclick="reæ‹†(txt,'\\\\begin{tabular}.+?\\\\end{tabular}')"  accesskey="b">æ‹†è¡¨</button>
<button onclick="é¡¹ä»¬=txt.split('\n')" accesskey="h">æ‹†è¡Œ</button>
<button onclick="æ¢å¤()" accesskey="r">æ¢å¤</button>
å°‘äº <input id="maxlim" style="width:4em"  accesskey="y" type="number" value="-1" title="æ‰è‡ªåŠ¨å±•ç¤º"/> 
<select>
    <option value="é¢˜">é¢˜todo</option>
    <option value="çŸ¥">çŸ¥</option>
    <option value="topic">topic</option>
</select>
<textarea id="hist" style="position:absolute;opacity:.7;" rows="1" accesskey="h" >è¾“å…¥å†å²</textarea>
</span><!-- <br/> -->
<span>
<input id="pf" accesskey="2" class="flt" onblur="æš´è®°(this)" placeholder="2ç®€å•ç­›é€‰ï¼Œç©ºæ ¼åˆ†éš”" />
<input id="ref" accesskey="3" class="flt" onblur="æš´è®°(this)" placeholder="3æ­£åˆ™ç­›é€‰ï¼Œå¯æˆ–" />
<input id="ren" accesskey="4" class="flt" onblur="æš´è®°(this)" placeholder="4æ­£åˆ™æ’é™¤" />
<button onclick="grep();document.forms[0].submit()" accesskey="s">æœ</button>
<input value="é‡ç½®(j)" type="reset" accesskey="J"/>
<input type="checkbox" onclick="åå¤„ç†= this.checked? æ¸…é™¤ç™¾åˆ†æ³¨:relax" accesskey="g" /> æ¸…é™¤ç™¾åˆ†æ³¨
</span>
</form todo="æƒ³ç”¨formè¡¨å•å†å²è®°å½•ç‰¹æ€§ï¼Œå¯æƒœä¼šè·³è½¬">
<pre id="r">showOpenFilePicker()showDirectoryPicker()showSaveFilePicker</pre>

<script type="text/javascript" src="cfg.js"></script>
<script>
c = console.log
txt = '' ; fl = 0; é¡¹ä»¬ = [];
const reader = new FileReader();
reader.onload = function (e) {
    const text = e.target.result.replace(/\r\n/g, '\n'); // reader.result
    fo[ff[fth].name] = text ; 
    txt += text; fth++;
    if (fth<fl) {reader.readAsText(ff[fth], "UTF-8")} else {console.log('é“¾å¼è¯»å–ï¼Œç»“æŸï¼Œæ‹¼æ¥ä¸º txtï¼Œå­—å…¸ä¸º fo')} // å¼‚æ­¥ä¸èƒ½ç”¨åŒä¸€ä¸ª reader å¹¶è¡Œ
    };
function è¯»æ–‡ä»¶(f){fo={};ff= f.files; fl=ff.length; fth = 0; reader.readAsText(ff[fth], "UTF-8")}
function reæ‹†(s,rt) {if (!rt) {return}; rt = RegExp(rt,'gs'); let it; é¡¹ä»¬ = []; console.log('æ­£åˆ™åŒ¹é…ä¸ºï¼š', rt)
    while (it = rt.exec(s)) {if (!é¡¹ä»¬.includes(it)) {é¡¹ä»¬.push(it[0])} };
    emcount.innerHTML= `é¡¹æ•°/ = ${é¡¹ä»¬.length}`
	return é¡¹ä»¬ }

function åˆ†æ‹†(s,rt) {if (!rt) {return}; é¡¹ä»¬ = []; é¡¹ä»¬ = s.split(rt);
	emcount.innerHTML= `é¡¹æ•°/${rt} = ${é¡¹ä»¬.length}` }  // Array.from(new Set(s.split(rt)))

function ç©ºæ ¼åˆ†éš”éƒ½å«filter(é¡¹) {let b = true; for (let y of å«) {if (!é¡¹.includes(y)){b=false;break}}; return b}
const relax = x => x
é¢„å¤„ç† =  åå¤„ç† = relax
const æ¸…é™¤ç™¾åˆ†æ³¨ = x => x.replace(/%<\/?[a-zA-Z]+.*\n/g, '').replace(/\n\n+/g, '\n\n')
function grep() {
	if (é¡¹ä»¬.length < 1) {ct.click();console.log("æœªæ‹†ï¼Œé»˜è®¤æ‹†é¢˜")};
    if (fileInput.files.length === 0 && !txt) { alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–æ‹–è¿‡æ¥') ; fileInput.click(); return; }
    å¯é¡¹ä»¬ = é¡¹ä»¬;
    if (pf.value){å« = pf.value.split(/\s+/) ; å¯é¡¹ä»¬ = å¯é¡¹ä»¬.filter(ç©ºæ ¼åˆ†éš”éƒ½å«filter) }  // ç›¸é‚» filter æ€§èƒ½ï¼Œè‡ªå·± ä¼˜åŒ–æœªå¿…æ¯”å¾—è¿‡åº•å±‚ä¼˜åŒ–
    if (ref.value){æ­£åˆ™ç­›é€‰å™¨ = RegExp(ref.value,'gs'); å¯é¡¹ä»¬ = å¯é¡¹ä»¬.filter(é¡¹=> æ­£åˆ™ç­›é€‰å™¨.test(é¡¹)) ;}
    if (ren.value){ååˆ™ç­›é€‰å™¨ = RegExp(ren.value,'gs'); å¯é¡¹ä»¬ = å¯é¡¹ä»¬.filter(é¡¹=> !ååˆ™ç­›é€‰å™¨.test(é¡¹)) ;}
    var æ•°é‡é™åˆ¶ = Number(maxlim.value); if (æ•°é‡é™åˆ¶ > 1 && å¯é¡¹ä»¬.length > æ•°é‡é™åˆ¶ && confirm(æ•°é‡é™åˆ¶ + ' ä¸ªï¼›\nç¬¦åˆæ¡ä»¶çš„å¾ˆå¤šï¼Œ\næ˜¯å¦åŠ æ¡ä»¶\n\nEnterï¼šç¡®è®¤\nEscï¼šå–æ¶ˆ')) {return false}
    result = (å¯é¡¹ä»¬.length>0)? å¯é¡¹ä»¬.join('\nğŸ”¥' + 'ä¸€ğŸ”¥'.repeat(25) +'\n') : 'æ— ğŸƒ'
    emcount.innerHTML= "é¡¹æ•° " + å¯é¡¹ä»¬.length + '/' + é¡¹ä»¬.length
    r.textContent = åå¤„ç†(result)
//     const resultLines = lines.filter(line => line.includes(pattern));
//     r.textContent = resultLines.join('\n');
}
function æœå•å­—ç¬¦ä¸²() {}
function æš´è®°(e) {if (e.value.length>3 && !hist.value.includes(e.value)) {hist.value += '\n' + e.value}}

function è®°ä¸Šä¸€æ¬¡() {document.querySelectorAll('input[id]:not([type])').forEach(x=>{if (x.value.length>3) {localStorage[x.id]=x.value}}) }
function æ¢å¤() {document.querySelectorAll('input[id]:not([type])').forEach(x=>{if (localStorage[x.id]) {x.value=localStorage[x.id]}}) }
window.onclose = window.onbeforeunload = è®°ä¸Šä¸€æ¬¡
document.querySelectorAll('[accesskey]').forEach(x=>{c(x.accessKey,x);x.innerHTML+= '/'  + x.accessKey})

function æ‹–æ”¾å¤„ç†(event){
	event.preventDefault()
	window.event.preventDefault() // é¿å…æµè§ˆå™¨é»˜è®¤æ‰“å¼€æ‹–åŠ¨çš„æ–‡ä»¶çš„æ“ä½œ
	document.title = 'grep ğŸ”'
	for (x of event.dataTransfer.files) {document.title += x.name + 'ï¼Œ'}
	è¯»æ–‡ä»¶(window.event.dataTransfer)
	return false }
function å›false(event){event.preventDefault(); return false}  // æ³¨æ„ï¼šondragleaveã€ondragendã€ondragover éƒ½å¾—é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œå¥½åƒä¸ç”¨ä¹Ÿè¡Œã€‚çµå¼‚ï¼
// TODO js ç¼–è¾‘è·ç¦»ï¼š https://blog.csdn.net/qq_29311407/article/details/79802216
</script>
</body>
</html>
